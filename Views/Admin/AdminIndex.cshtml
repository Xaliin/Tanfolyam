@{
    ViewData["Title"] = "Adminisztráció";
}

<section class="maintext">
    <h1>Adminisztrációs felület</h1><hr />
</section>
<section class="adminsection">
    <div>
        <h3>Egyenleg módosítása</h3>
        <form asp-action="AddBudget">
            + <input type="number" name="budget" class="admininput" placeholder="..." /> Ft <select class="admininput" name="userId" asp-controller="Admin" asp-items="ViewBag.Users"></select> számára
            <button type="submit" class="save-btn">Mentés</button>
        </form>
    </div>
</section>
<section class="adminsection">
    <div>
        <a asp-area="Admin" asp-controller="Admin" asp-action="TeacherListing"><h3>Oktató felvétele</h3></a>
    </div>
</section>
<section class="adminsection">
    <a asp-area="Admin" asp-controller="Admin" asp-action="CourseListing"><h3>Tanfolyamok hozzáadása/módosítása/törlése</h3></a>
</section>
<section>
    <h3>Statisztika</h3>
    idejönnek a diagrammok
</section>

<h1>Teacher Student Pie Chart</h1>

<form id="dateFilterForm">
    <label for="startDate">Start Date:</label>
    <input type="datetime-local" id="startDate" name="startDate" required>
    
    <label for="endDate">End Date:</label>
    <input type="datetime-local" id="endDate" name="endDate" required>
    
    <button type="button" onclick="fetchChartData()">Get Chart</button>
</form>

<canvas id="teacherPieChart" width="400" height="400"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    let chartInstance = null; 

function fetchChartData() {
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;

    if (!startDate || !endDate) {
        alert('Please select both start and end dates.');
        return;
    }

    fetch(`/Admin/GetChartDataForAmoutOfStudentsPerTeacher?startDate=${encodeURIComponent(startDate)}&endDate=${encodeURIComponent(endDate)}`)
        .then(response => response.json())
        .then(data => {
            const labels = Object.keys(data); 
            const values = Object.values(data); 

            const ctx = document.getElementById('teacherPieChart').getContext('2d');

            if (labels.length === 0 || values.length === 0) {
                alert('No data available for the selected date range.');
                

                if (chartInstance) {
                    chartInstance.destroy();
                }
                return;
            }


            if (chartInstance) {
                chartInstance.destroy();
            }


            chartInstance = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(255, 206, 86, 0.6)',
                            'rgba(75, 192, 192, 0.6)',
                            'rgba(153, 102, 255, 0.6)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: 'Number of Students per Teacher (Filtered)'
                        }
                    }
                }
            });
        })
        .catch(error => console.error('Error fetching data:', error));
}
</script>